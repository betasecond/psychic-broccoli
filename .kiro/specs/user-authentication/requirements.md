# 用户认证系统需求文档

## 简介

用户认证系统是在线教育平台的核心基础模块，负责用户的注册、登录、权限管理和个人信息维护。该系统需要支持三种用户角色：学生(STUDENT)、教师(INSTRUCTOR)和管理员(ADMIN)，并提供安全可靠的JWT认证机制。

## 需求

### 需求 1: 用户注册功能

**用户故事:** 作为一个新用户，我希望能够注册账号，以便使用在线教育平台的服务。

#### 验收标准

1. WHEN 用户访问注册页面 THEN 系统 SHALL 显示包含用户名、密码、确认密码和角色选择的注册表单
2. WHEN 用户提交有效的注册信息 THEN 系统 SHALL 创建新用户账号并返回成功消息
3. WHEN 用户提交重复的用户名 THEN 系统 SHALL 返回"用户名已存在"的错误提示
4. WHEN 用户密码少于6位 THEN 系统 SHALL 返回"密码长度不能少于6位"的错误提示
5. WHEN 用户确认密码与密码不匹配 THEN 系统 SHALL 返回"两次密码输入不一致"的错误提示
6. WHEN 用户未选择角色 THEN 系统 SHALL 默认设置为学生角色

### 需求 2: 用户登录功能

**用户故事:** 作为一个已注册用户，我希望能够登录系统，以便访问我的个人账户和相关功能。

#### 验收标准

1. WHEN 用户访问登录页面 THEN 系统 SHALL 显示包含用户名和密码的登录表单
2. WHEN 用户提交正确的用户名和密码 THEN 系统 SHALL 返回JWT访问令牌并跳转到对应角色的仪表板
3. WHEN 用户提交错误的用户名或密码 THEN 系统 SHALL 返回"用户名或密码错误"的错误提示
4. WHEN 用户登录成功 THEN 系统 SHALL 将JWT令牌存储在浏览器中用于后续请求认证
5. WHEN 学生登录成功 THEN 系统 SHALL 跳转到学生仪表板页面
6. WHEN 教师登录成功 THEN 系统 SHALL 跳转到教师仪表板页面

### 需求 3: JWT认证与授权

**用户故事:** 作为系统管理员，我希望确保所有API请求都经过适当的认证和授权，以保护系统安全。

#### 验收标准

1. WHEN 用户成功登录 THEN 系统 SHALL 生成包含用户ID和角色信息的JWT令牌
2. WHEN 用户访问受保护的API端点 THEN 系统 SHALL 验证请求头中的JWT令牌
3. WHEN JWT令牌有效 THEN 系统 SHALL 允许访问并在请求上下文中提供用户信息
4. WHEN JWT令牌无效或过期 THEN 系统 SHALL 返回401未授权错误
5. WHEN 用户尝试访问超出其角色权限的资源 THEN 系统 SHALL 返回403禁止访问错误
6. WHEN JWT令牌即将过期 THEN 系统 SHALL 提供令牌刷新机制

### 需求 4: 用户个人信息管理

**用户故事:** 作为一个已登录用户，我希望能够查看和更新我的个人信息，以保持账户信息的准确性。

#### 验收标准

1. WHEN 用户访问个人资料页面 THEN 系统 SHALL 显示当前用户的基本信息（用户名、邮箱、头像）
2. WHEN 用户更新个人信息 THEN 系统 SHALL 验证信息格式并保存更改
3. WHEN 用户上传头像 THEN 系统 SHALL 将图片上传到OSS并更新用户头像URL
4. WHEN 用户修改密码 THEN 系统 SHALL 要求输入当前密码进行验证
5. WHEN 用户提交新密码 THEN 系统 SHALL 使用BCrypt加密存储新密码
6. WHEN 用户保存个人信息成功 THEN 系统 SHALL 显示成功提示消息

### 需求 5: 用户会话管理

**用户故事:** 作为一个用户，我希望系统能够安全地管理我的登录会话，包括自动登出和会话保持功能。

#### 验收标准

1. WHEN 用户点击登出按钮 THEN 系统 SHALL 清除本地存储的JWT令牌并跳转到登录页面
2. WHEN 用户关闭浏览器后重新打开 THEN 系统 SHALL 检查本地JWT令牌的有效性
3. WHEN JWT令牌仍然有效 THEN 系统 SHALL 自动保持用户登录状态
4. WHEN JWT令牌已过期 THEN 系统 SHALL 自动跳转到登录页面
5. WHEN 用户在多个标签页中操作 THEN 系统 SHALL 在所有标签页中同步登录状态
6. WHEN 检测到异常登录行为 THEN 系统 SHALL 强制用户重新登录

### 需求 6: 获取当前用户信息

**用户故事:** 作为一个已登录用户，我希望系统能够识别我的身份并在界面上显示相关信息。

#### 验收标准

1. WHEN 用户访问任何需要认证的页面 THEN 系统 SHALL 通过JWT令牌获取当前用户信息
2. WHEN 获取用户信息成功 THEN 系统 SHALL 在页面头部显示用户头像和用户名
3. WHEN 用户信息包含角色信息 THEN 系统 SHALL 根据角色显示相应的导航菜单
4. WHEN 无法获取用户信息 THEN 系统 SHALL 跳转到登录页面
5. WHEN 用户角色为教师 THEN 系统 SHALL 显示课程管理相关功能入口
6. WHEN 用户角色为学生 THEN 系统 SHALL 显示学习相关功能入口