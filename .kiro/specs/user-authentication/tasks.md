# 用户认证系统实现计划

## 实现任务

- [x] 1. 后端基础架构搭建





  - 配置Spring Boot项目基础依赖和安全框架
  - 创建用户实体类和数据库表结构
  - 配置JWT工具类和安全配置
  - _需求: 1.1, 2.1, 3.1_

- [x] 1.1 创建用户实体和数据库配置


  - 实现User实体类，包含id、username、passwordHash、email、avatarUrl、role等字段
  - 配置PostgreSQL数据源和JPA设置
  - 创建数据库迁移脚本，建立users表和相关索引
  - _需求: 1.2, 2.2, 4.2_

- [x] 1.2 实现JWT工具类和安全配置


  - 创建JwtUtils工具类，实现JWT令牌的生成、验证和解析
  - 配置Spring Security，设置JWT过滤器和认证入口点
  - 实现JwtAuthenticationFilter，拦截请求并验证JWT令牌
  - _需求: 2.4, 3.1, 3.2, 3.3_

- [ ] 2. 用户注册功能实现
  - 创建注册相关的DTO类和验证逻辑
  - 实现用户注册API端点和业务逻辑
  - 添加用户名重复检查和密码加密功能
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [ ] 2.1 创建注册请求和响应DTO
  - 实现RegisterRequest类，包含username、password、confirmPassword、role字段
  - 实现RegisterResponse类，包含userId和username字段
  - 添加Bean Validation注解进行输入验证
  - _需求: 1.1, 1.4, 1.5_

- [ ] 2.2 实现用户注册服务层
  - 创建AuthService类，实现register方法
  - 添加用户名唯一性检查逻辑
  - 使用BCrypt对密码进行加密存储
  - 设置默认角色为STUDENT
  - _需求: 1.2, 1.3, 1.6_

- [ ] 2.3 创建注册API控制器
  - 实现AuthController的register端点
  - 添加请求参数验证和异常处理
  - 返回统一的API响应格式
  - _需求: 1.1, 1.2_

- [ ] 3. 用户登录功能实现
  - 创建登录相关的DTO类和认证逻辑
  - 实现用户登录API端点和JWT令牌生成
  - 添加登录失败处理和错误提示
  - _需求: 2.1, 2.2, 2.3, 2.4_

- [ ] 3.1 创建登录请求和响应DTO
  - 实现LoginRequest类，包含username和password字段
  - 实现LoginResponse类，包含accessToken、tokenType和用户信息
  - 实现UserResponse类，包含用户基本信息字段
  - _需求: 2.1, 2.2_

- [ ] 3.2 实现用户登录服务层
  - 在AuthService中实现login方法
  - 添加用户凭据验证逻辑
  - 生成包含用户ID和角色的JWT令牌
  - _需求: 2.2, 2.4, 3.1_

- [ ] 3.3 创建登录API控制器
  - 实现AuthController的login端点
  - 添加认证失败的错误处理
  - 根据用户角色返回相应的跳转信息
  - _需求: 2.1, 2.3, 2.5, 2.6_

- [ ] 4. 获取当前用户信息功能
  - 实现获取当前登录用户信息的API
  - 添加JWT令牌验证和用户信息提取
  - 处理令牌无效和过期的情况
  - _需求: 6.1, 6.2, 6.4_

- [ ] 4.1 实现获取用户信息服务
  - 在AuthService中实现getCurrentUser方法
  - 从JWT令牌中提取用户ID并查询用户信息
  - 处理用户不存在的异常情况
  - _需求: 6.1, 6.2_

- [ ] 4.2 创建用户信息API控制器
  - 实现AuthController的getCurrentUser端点
  - 添加JWT认证要求和权限验证
  - 返回用户基本信息，不包含敏感数据
  - _需求: 6.1, 6.3, 6.4_

- [ ] 5. 用户个人信息管理功能
  - 实现用户资料更新API和头像上传功能
  - 添加密码修改功能和验证逻辑
  - 集成阿里云OSS进行头像文件存储
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [ ] 5.1 创建个人信息更新DTO
  - 实现UpdateProfileRequest类，包含email、avatarUrl等字段
  - 实现ChangePasswordRequest类，包含当前密码和新密码
  - 添加输入验证注解和自定义验证逻辑
  - _需求: 4.1, 4.4, 4.5_

- [ ] 5.2 实现个人信息更新服务
  - 在AuthService中实现updateProfile方法
  - 实现changePassword方法，验证当前密码
  - 添加头像上传到OSS的集成逻辑
  - _需求: 4.2, 4.3, 4.5_

- [ ] 5.3 创建个人信息管理API
  - 实现更新个人信息的API端点
  - 实现修改密码的API端点
  - 实现获取OSS上传凭证的API端点
  - _需求: 4.1, 4.4, 4.6_

- [ ] 6. 前端React项目基础搭建
  - 配置React + Vite项目和必要依赖
  - 设置Redux Toolkit状态管理
  - 配置路由和API请求拦截器
  - _需求: 2.4, 3.4, 5.5_

- [ ] 6.1 配置前端项目依赖
  - 安装React Router、Redux Toolkit、Ant Design等依赖
  - 配置Vite构建工具和开发服务器
  - 设置ESLint和Prettier代码规范
  - _需求: 2.4, 5.5_

- [ ] 6.2 创建Redux状态管理
  - 实现authSlice，管理用户认证状态
  - 配置Redux store和中间件
  - 创建异步action处理登录、注册等操作
  - _需求: 2.4, 3.4, 5.5_

- [ ] 6.3 配置API服务和拦截器
  - 创建axios实例和请求拦截器
  - 实现JWT令牌自动添加到请求头
  - 添加响应拦截器处理401和403错误
  - _需求: 3.4, 5.1, 5.2_

- [ ] 7. 前端认证页面实现
  - 创建登录和注册页面组件
  - 实现表单验证和用户交互
  - 添加错误提示和加载状态
  - _需求: 1.1, 2.1, 2.3_

- [ ] 7.1 创建登录页面组件
  - 实现LoginPage组件，包含用户名和密码输入框
  - 添加表单验证和提交处理逻辑
  - 实现登录成功后的页面跳转
  - _需求: 2.1, 2.3, 2.5, 2.6_

- [ ] 7.2 创建注册页面组件
  - 实现RegisterPage组件，包含注册表单
  - 添加密码确认和角色选择功能
  - 实现注册成功后的提示和跳转
  - _需求: 1.1, 1.4, 1.5, 1.6_

- [ ] 7.3 创建认证页面布局
  - 实现AuthLayout组件，提供统一的认证页面布局
  - 添加响应式设计和品牌元素
  - 实现页面切换动画效果
  - _需求: 1.1, 2.1_

- [ ] 8. 前端路由守卫和会话管理
  - 实现路由守卫组件保护需要认证的页面
  - 添加自动登录和会话保持功能
  - 实现登出和多标签页状态同步
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8.1 创建路由守卫组件
  - 实现ProtectedRoute组件，检查用户认证状态
  - 添加角色基础的访问控制逻辑
  - 实现未认证用户的自动跳转
  - _需求: 5.1, 5.4, 6.4_

- [ ] 8.2 实现会话管理功能
  - 添加JWT令牌的本地存储和自动加载
  - 实现令牌过期检查和自动登出
  - 添加多标签页之间的状态同步
  - _需求: 5.2, 5.3, 5.5_

- [ ] 8.3 创建登出功能
  - 实现logout action和相关UI组件
  - 清除本地存储的认证信息
  - 实现登出后的页面跳转
  - _需求: 5.1_

- [ ] 9. 前端个人资料页面实现
  - 创建个人资料查看和编辑页面
  - 实现头像上传和个人信息更新
  - 添加密码修改功能
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [ ] 9.1 创建个人资料页面组件
  - 实现ProfilePage组件，显示用户基本信息
  - 添加信息编辑表单和保存功能
  - 实现头像预览和上传功能
  - _需求: 4.1, 4.2, 4.3, 4.6_

- [ ] 9.2 实现头像上传功能
  - 集成阿里云OSS直传功能
  - 添加图片预览和裁剪功能
  - 实现上传进度显示和错误处理
  - _需求: 4.3_

- [ ] 9.3 创建密码修改功能
  - 实现密码修改表单组件
  - 添加当前密码验证逻辑
  - 实现密码强度检查和确认
  - _需求: 4.4, 4.5_

- [ ] 10. 用户界面个性化和导航
  - 根据用户角色显示不同的导航菜单
  - 实现用户头像和信息的全局显示
  - 添加角色基础的功能入口
  - _需求: 6.2, 6.3, 6.5, 6.6_

- [ ] 10.1 创建全局用户信息组件
  - 实现UserAvatar组件，在页面头部显示用户信息
  - 添加下拉菜单，包含个人资料和登出选项
  - 实现用户信息的实时更新
  - _需求: 6.2, 6.3_

- [ ] 10.2 实现角色基础的导航
  - 根据用户角色动态生成导航菜单
  - 为教师用户显示课程管理入口
  - 为学生用户显示学习相关功能
  - _需求: 6.3, 6.5, 6.6_

- [ ] 11. 测试和错误处理完善
  - 编写前后端单元测试和集成测试
  - 完善错误处理和用户提示
  - 进行安全测试和性能优化
  - _需求: 所有需求的质量保证_

- [ ] 11.1 编写后端测试用例
  - 为AuthService编写单元测试
  - 为AuthController编写集成测试
  - 测试JWT认证和权限控制功能
  - _需求: 1.1-6.6_

- [ ] 11.2 编写前端测试用例
  - 为认证相关组件编写单元测试
  - 测试Redux状态管理和API调用
  - 编写E2E测试覆盖完整用户流程
  - _需求: 1.1-6.6_

- [ ] 11.3 完善错误处理和用户体验
  - 添加全局错误处理和用户友好的错误提示
  - 优化加载状态和交互反馈
  - 进行安全漏洞检查和性能优化
  - _需求: 所有需求的用户体验优化_