# 学习进度追踪功能测试计划

## 测试概述

**测试对象**: 学习进度追踪功能
**测试日期**: 2026-02-05
**测试人员**: 金牌测试员
**项目版本**: master分支最新版本

## 功能说明

学习进度追踪功能允许学生：
1. 查看已选课程的学习进度百分比
2. 标记章节完成状态
3. 系统自动计算课程总体进度
4. 追踪视频播放进度（自动上报）

---

## 测试范围

### 1. 后端API测试
- PUT `/api/v1/courses/:id/progress` - 更新课程进度
- POST `/api/v1/chapters/:id/complete` - 标记章节完成
- GET `/api/v1/courses/my` - 获取我的课程（含进度）

### 2. 数据库测试
- `course_enrollments` 表的 progress 字段
- `chapter_completions` 表的完整性约束
- 索引性能测试

### 3. 前端功能测试
- 课程列表页面进度显示
- 课程详情页面章节完成功能
- 视频进度自动追踪
- Redux状态更新

### 4. 集成测试
- 完整的学习流程测试
- 多用户并发测试
- 数据一致性测试

---

## 测试用例设计

### TC-01: 后端API测试

#### TC-01-01: 更新课程进度 - 正常场景
**前置条件**:
- 学生已登录
- 学生已选修课程ID=1

**测试步骤**:
1. 发送 PUT 请求到 `/api/v1/courses/1/progress`
2. Body: `{"progress": 50}`
3. 验证响应状态码 200
4. 验证返回消息包含"进度更新成功"

**预期结果**:
- 响应状态码: 200
- 数据库 course_enrollments 表的 progress 字段更新为 50
- 返回成功消息

**测试数据**: progress = 0, 25, 50, 75, 100

---

#### TC-01-02: 更新课程进度 - 边界值测试
**测试数据**:
- progress = -1 (负数)
- progress = 101 (超过100)
- progress = 0 (最小值)
- progress = 100 (最大值)
- progress = 非数字字符串

**预期结果**:
- 0-100 范围内: 成功更新
- 范围外或无效值: 返回错误信息

---

#### TC-01-03: 更新课程进度 - 权限测试
**测试场景**:
1. 未登录用户
2. 学生更新未选修的课程
3. 教师尝试更新学生的课程进度

**预期结果**:
- 未登录: 401 Unauthorized
- 未选修课程: 404 或 403 Forbidden
- 教师无权限: 403 Forbidden

---

#### TC-01-04: 标记章节完成 - 正常场景
**前置条件**:
- 学生已登录
- 学生已选修课程ID=1
- 课程有10个章节

**测试步骤**:
1. 发送 POST 请求到 `/api/v1/chapters/5/complete`
2. 验证响应状态码 200
3. 验证返回的 progress、completedCount、totalCount

**预期结果**:
- 响应状态码: 200
- completedCount 增加 1
- progress = (completedCount / totalCount) * 100
- chapter_completions 表插入新记录

---

#### TC-01-05: 标记章节完成 - 重复完成测试
**测试步骤**:
1. 第一次标记章节5完成
2. 第二次标记章节5完成

**预期结果**:
- 第一次: 成功，completedCount = 1
- 第二次: 成功（幂等操作），completedCount 不变
- 数据库使用 INSERT OR REPLACE，不产生重复记录

---

#### TC-01-06: 标记章节完成 - 进度自动计算测试
**前置条件**:
- 课程有5个章节（ID: 1, 2, 3, 4, 5）

**测试步骤**:
| 步骤 | 操作 | 预期 completedCount | 预期 progress |
|-----|------|-------------------|--------------|
| 1   | 完成章节1 | 1 | 20% |
| 2   | 完成章节2 | 2 | 40% |
| 3   | 完成章节3 | 3 | 60% |
| 4   | 完成章节4 | 4 | 80% |
| 5   | 完成章节5 | 5 | 100% |

**验证点**:
- 每次完成后 progress 字段正确更新
- completedCount 准确累加
- totalCount 始终等于5

---

#### TC-01-07: 获取我的课程 - 进度信息验证
**前置条件**:
- 学生选修了3门课程
- 课程1: 完成2/10章节，progress=20%
- 课程2: 完成5/5章节，progress=100%
- 课程3: 未完成任何章节，progress=0%

**测试步骤**:
1. 发送 GET 请求到 `/api/v1/courses/my`
2. 验证返回的课程列表

**预期结果**:
- 返回3门课程
- 每门课程包含字段: totalChapters, completedChapters, progress
- 进度数据与数据库一致

---

### TC-02: 数据库完整性测试

#### TC-02-01: 唯一性约束测试
**测试项目**:
1. course_enrollments 表: (student_id, course_id) UNIQUE
2. chapter_completions 表: (student_id, chapter_id) UNIQUE

**测试步骤**:
1. 尝试插入重复的选课记录
2. 尝试插入重复的章节完成记录

**预期结果**:
- 数据库约束生效
- 插入失败或被 REPLACE 替换

---

#### TC-02-02: 外键约束测试
**测试场景**:
1. 插入不存在的 student_id
2. 插入不存在的 course_id
3. 插入不存在的 chapter_id

**预期结果**:
- 外键约束生效
- 插入失败并返回错误

---

#### TC-02-03: 默认值测试
**验证字段**:
- course_enrollments.progress 默认值 = 0
- enrolled_at 默认值 = CURRENT_TIMESTAMP
- completed_at 默认值 = CURRENT_TIMESTAMP

**测试步骤**:
1. 插入选课记录但不指定 progress
2. 查询验证 progress = 0

**预期结果**:
- 默认值正确生效

---

#### TC-02-04: 索引性能测试
**测试索引**:
- idx_chapter_completions_student_id
- idx_chapter_completions_chapter_id

**测试步骤**:
1. 插入10000条章节完成记录
2. 执行查询并使用 EXPLAIN 分析
3. 验证是否使用了索引

**预期结果**:
- 查询使用索引
- 查询时间 < 100ms

---

### TC-03: 前端功能测试

#### TC-03-01: 课程列表页面显示测试
**测试页面**: `/courses`

**验证点**:
1. 进度百分比正确显示
2. 进度条颜色：
   - 0-99%: 蓝色（进行中）
   - 100%: 绿色（已完成）
3. 状态标签：
   - 0-99%: "进行中"
   - 100%: "已完成"
4. 操作按钮：
   - 0-99%: "继续学习"
   - 100%: "查看"

**测试数据**:
| 课程 | progress | 预期显示 |
|-----|---------|---------|
| 课程A | 0% | 蓝色进度条，"进行中"，"继续学习" |
| 课程B | 50% | 蓝色进度条，"进行中"，"继续学习" |
| 课程C | 100% | 绿色进度条，"已完成"，"查看" |

---

#### TC-03-02: 课程详情页面 - 章节完成测试
**测试页面**: `/courses/:id`

**测试步骤**:
1. 进入课程详情页
2. 验证初始进度显示
3. 点击某个章节的"标记完成"按钮
4. 验证UI更新

**预期结果**:
- 圆形进度条实时更新
- "已完成 X / Y 章节" 文本更新
- 该章节的完成图标变为绿色勾选
- "标记完成"按钮变灰并禁用
- 进度百分比重新计算

---

#### TC-03-03: 视频进度自动追踪测试
**测试组件**: useVideoProgress Hook

**测试步骤**:
1. 播放视频30秒
2. 验证进度上报（每30秒）
3. 播放到95%
4. 验证自动标记完成

**预期结果**:
- 每30秒调用 updateProgress API
- 进度变化超过5%时才上报
- 播放≥95%时自动调用 completeChapter API
- 视频播放结束时触发 onChapterComplete 回调

---

#### TC-03-04: Redux状态管理测试
**验证点**:
1. fetchMyCourses 正确加载课程列表
2. 课程进度数据存储在 myCourses 数组
3. 标记完成后本地状态立即更新
4. 页面刷新后状态重新加载

**测试步骤**:
1. 打开课程列表页，检查 Redux DevTools
2. 标记章节完成，观察 state 变化
3. 刷新页面，验证数据重新加载

---

### TC-04: 边界条件和异常场景测试

#### TC-04-01: 空数据测试
**测试场景**:
1. 课程没有任何章节（totalChapters = 0）
2. 学生没有选修任何课程
3. 所有章节都未完成

**预期结果**:
- 没有章节时 progress = 0%
- 空课程列表显示提示信息
- 不会发生除零错误

---

#### TC-04-02: 并发操作测试
**测试场景**:
1. 两个浏览器同时标记同一章节完成
2. 快速连续点击"标记完成"按钮

**预期结果**:
- 数据库 UNIQUE 约束防止重复
- 客户端防抖处理
- 最终数据一致

---

#### TC-04-03: 网络错误处理测试
**测试场景**:
1. API 请求超时
2. 服务器返回 500 错误
3. 网络断开

**预期结果**:
- 显示错误提示
- 不更新本地状态
- 用户可以重试

---

#### TC-04-04: 权限切换测试
**测试场景**:
1. 学生登录 → 标记完成 → 退出登录
2. 学生A登录 → 标记完成 → 切换到学生B

**预期结果**:
- 退出后无法访问进度API
- 不同学生的进度数据隔离
- 不会互相影响

---

### TC-05: 端到端集成测试

#### TC-05-01: 完整学习流程测试
**测试流程**:
1. 学生登录
2. 浏览并选修课程
3. 进入课程详情页
4. 逐个标记章节完成
5. 验证进度从0%增长到100%
6. 返回课程列表，验证状态变为"已完成"

**预期结果**:
- 整个流程顺畅无阻塞
- 数据实时同步
- 前后端状态一致

---

#### TC-05-02: 多用户并发学习测试
**测试场景**:
- 3个学生同时学习同一门课程
- 每个学生标记不同的章节完成

**验证点**:
- 每个学生的进度独立
- 不会互相干扰
- 数据库事务正确处理

---

#### TC-05-03: 数据一致性验证
**验证项目**:
1. 前端显示的进度 = 后端API返回的进度
2. 后端API返回的进度 = 数据库存储的进度
3. 进度百分比计算公式正确

**测试步骤**:
1. 标记章节完成
2. 查询数据库验证 progress 值
3. 调用 API 验证返回值
4. 前端显示验证

---

## 测试环境

### 后端环境
- Go 版本: 1.21+
- 数据库: SQLite
- API Base URL: http://localhost:8080

### 前端环境
- React + TypeScript
- Redux Toolkit
- Vite 开发服务器
- 浏览器: Chrome, Firefox, Edge

### 测试工具
- API 测试: Postman / curl
- 数据库查询: SQLite Browser
- 前端调试: React DevTools, Redux DevTools
- 网络监控: Browser DevTools Network Tab

---

## 测试数据准备

### 测试用户
| 用户ID | 用户名 | 角色 | 密码 |
|-------|-------|-----|-----|
| 1 | teacher1 | 教师 | password123 |
| 2 | student1 | 学生 | password123 |
| 3 | student2 | 学生 | password123 |
| 4 | student3 | 学生 | password123 |

### 测试课程
| 课程ID | 课程名称 | 章节数 |
|-------|---------|-------|
| 1 | Go语言入门 | 10 |
| 2 | React进阶 | 5 |
| 3 | 数据库设计 | 8 |

### 测试选课关系
| 学生ID | 课程ID | 初始进度 |
|-------|-------|---------|
| 2 | 1 | 0% |
| 2 | 2 | 40% (2/5完成) |
| 3 | 1 | 50% (5/10完成) |
| 3 | 3 | 100% (8/8完成) |

---

## 测试执行计划

### Phase 1: 单元测试（API级别）
- 执行时间: 1小时
- 执行所有 TC-01 测试用例
- 验证后端API功能

### Phase 2: 数据库测试
- 执行时间: 30分钟
- 执行所有 TC-02 测试用例
- 验证数据完整性

### Phase 3: 前端功能测试
- 执行时间: 1小时
- 执行所有 TC-03 测试用例
- 验证UI交互

### Phase 4: 边界和异常测试
- 执行时间: 45分钟
- 执行所有 TC-04 测试用例
- 压力测试

### Phase 5: 端到端测试
- 执行时间: 1小时
- 执行所有 TC-05 测试用例
- 完整流程验证

**总预计时间**: 4小时15分钟

---

## 测试通过标准

### 必须通过项（P0）
- 所有正常场景测试用例 100% 通过
- 无数据丢失或损坏
- 无安全漏洞（权限校验通过）
- 进度计算公式正确

### 应该通过项（P1）
- 边界值测试 90% 通过
- 异常处理得当
- 用户体验良好

### 可选通过项（P2）
- 性能优化建议
- UI优化建议

---

## 缺陷严重级别定义

### Critical（致命）
- 数据丢失或损坏
- 系统崩溃
- 安全漏洞

### High（高）
- 核心功能无法使用
- 进度计算错误
- 权限校验失败

### Medium（中）
- 非核心功能异常
- UI显示错误
- 性能问题

### Low（低）
- 文案错误
- 样式瑕疵
- 优化建议

---

## 测试输出物

1. **测试执行报告** (progress-tracking-test-report.md)
   - 测试用例执行结果
   - 缺陷列表
   - 测试覆盖率

2. **缺陷报告** (progress-tracking-bugs.md)
   - 每个缺陷的详细描述
   - 复现步骤
   - 截图和日志

3. **性能测试报告** (progress-tracking-performance.md)
   - API响应时间
   - 数据库查询性能
   - 前端渲染性能

4. **测试建议** (progress-tracking-recommendations.md)
   - 功能改进建议
   - 代码优化建议
   - 用户体验优化

---

## 下一步行动

1. ✅ 设计测试计划和测试用例
2. ⏳ 准备测试环境和数据
3. ⏳ 执行后端API测试
4. ⏳ 执行数据库测试
5. ⏳ 执行前端功能测试
6. ⏳ 执行边界和异常测试
7. ⏳ 执行端到端集成测试
8. ⏳ 汇总测试结果并生成报告
