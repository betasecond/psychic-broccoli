# 后端服务器使用说明

## 快速开始

### 🚀 方法一：前台运行（推荐用于开发调试）

在backend目录下运行：
```powershell
.\start-server.ps1
```

这会在当前窗口运行服务器，可以看到所有日志输出。
按 `Ctrl+C` 可以停止服务器。

### 🚀 方法二：后台运行（推荐用于测试）

在backend目录下运行：
```powershell
.\start-background.ps1
```

服务器会在后台运行，不占用当前终端窗口。

要停止后台服务器：
```powershell
.\stop-server.ps1
```

## 🧪 测试API

运行测试脚本：
```powershell
.\test-api.ps1
```

这个脚本会自动测试：
- ✅ 健康检查
- ✅ 用户注册
- ✅ 用户登录
- ✅ 获取课程列表
- ✅ 获取分类
- ✅ 获取当前用户信息

## 📍 服务器信息

- **监听地址**: http://localhost:8080
- **API基础路径**: http://localhost:8080/api/v1
- **健康检查**: http://localhost:8080/health
- **数据库文件**: ./database/education.db

## 👤 测试账号

系统自动创建了以下测试账号（密码都是 `password123`）：

| 角色 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| 学生 | student | password123 | 可以选课、提交作业、参加考试 |
| 教师 | instructor | password123 | 可以创建课程、布置作业、批改作业 |
| 管理员 | admin | password123 | 拥有所有权限 |

## 📚 API端点列表

### 认证相关 (/api/v1/auth)
- `POST /login` - 用户登录
- `POST /register` - 用户注册
- `GET /me` - 获取当前用户信息（需要认证）
- `PUT /profile` - 更新用户资料（需要认证）
- `PUT /password` - 修改密码（需要认证）
- `GET /check-username` - 检查用户名是否可用
- `GET /check-email` - 检查邮箱是否可用

### 课程相关 (/api/v1/courses)
- `GET /` - 获取课程列表
- `POST /` - 创建课程（需要认证-教师/管理员）
- `GET /:id` - 获取课程详情
- `PUT /:id` - 更新课程（需要认证-课程教师/管理员）
- `DELETE /:id` - 删除课程（需要认证-课程教师/管理员）
- `POST /:id/enroll` - 学生选课（需要认证-学生）
- `GET /:id/chapters` - 获取课程章节
- `POST /:id/chapters` - 创建章节（需要认证-课程教师/管理员）

### 作业相关 (/api/v1/assignments)
- `GET /` - 获取作业列表（需要认证）
- `POST /` - 创建作业（需要认证-教师/管理员）
- `GET /:id` - 获取作业详情（需要认证）
- `POST /:id/submit` - 提交作业（需要认证-学生）
- `GET /submissions` - 获取提交列表（需要认证）
- `PUT /submissions/:id/grade` - 批改作业（需要认证-教师/管理员）

### 考试相关 (/api/v1/exams)
- `GET /` - 获取考试列表（需要认证）
- `POST /` - 创建考试（需要认证-教师/管理员）
- `GET /:id` - 获取考试详情（需要认证）
- `POST /:id/questions` - 添加题目（需要认证-教师/管理员）
- `POST /:id/submit` - 提交答卷（需要认证-学生）
- `GET /:id/results` - 获取成绩列表（需要认证-教师/管理员）

### 分类相关 (/api/v1/categories)
- `GET /` - 获取课程分类列表

## 🛠️ 常见问题

### 1. 服务器无法启动
- 检查8080端口是否被占用
- 运行 `netstat -ano | findstr :8080` 查看端口占用情况
- 可以通过设置环境变量修改端口：`$env:SERVER_PORT="8081"`

### 2. API测试失败
- 确保服务器已启动
- 检查防火墙设置
- 查看服务器日志输出

### 3. 数据库错误
- 删除 `database/education.db` 文件，重启服务器会自动重建

### 4. 如何查看后台进程
```powershell
Get-Process -Name "server"
```

### 5. 如何强制停止所有server进程
```powershell
Get-Process -Name "server" | Stop-Process -Force
```

## 📝 开发提示

1. **修改代码后需要重新编译**：
   ```powershell
   go build -o server.exe main.go
   ```

2. **查看数据库内容**：
   使用SQLite客户端工具打开 `database/education.db`

3. **重置数据库**：
   删除 `database/education.db` 文件，重启服务器

4. **修改配置**：
   通过环境变量覆盖默认配置：
   ```powershell
   $env:SERVER_PORT="8081"
   $env:JWT_SECRET="your-custom-secret"
   .\start-server.ps1
   ```

## 🔗 前端集成

前端需要设置API基础URL为：
```
http://localhost:8080/api/v1
```

在前端的 `.env` 文件中：
```
VITE_API_BASE_URL=http://localhost:8080/api/v1
```

## 📦 项目结构

```
backend/
├── server.exe              # 编译后的可执行文件
├── start-server.ps1        # 前台启动脚本
├── start-background.ps1    # 后台启动脚本
├── stop-server.ps1         # 停止服务器脚本
├── test-api.ps1           # API测试脚本
├── main.go                # 主程序入口
├── config/                # 配置管理
├── models/                # 数据模型
├── database/              # 数据库相关
│   ├── schema.sql        # 数据库Schema
│   ├── db.go             # 数据库连接
│   ├── seed.go           # 测试数据
│   └── education.db      # SQLite数据库文件（运行时生成）
├── handlers/              # API处理器
├── middleware/            # 中间件
└── utils/                 # 工具函数
```

